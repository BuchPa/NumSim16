# NumSim16
Numerische Simulation 2016/2017

## Requirements
* gcc for C++ version 11 or greater
* scons
* mpich or mpich2
* gprof (performance analysis only)
* doxygen (documentation only)

## Installation
1. ```git clone https://github.com/BuchPa/NumSim16.git```
2. ```cd NumSim16```
3. ```mkdir VTK```

## Compile
1. ```scons debug=-1 -j #NP``` where #NP is replaced with the number of processors

## Run
1. ```mpirun.mpich -np #NP ./build/NumSim``` where #NP is replaced with the number of processors

## Parameters
### Geometry parameters
Modify file ex1_geometry to change the boundary values, domain size and grid size. The borders are numbered clockwise from the top, so four values corresponds to the four boundaries.

### Model parameters
Modify file ex1_parameter to change the model parameters.
* re : The Reynolds number
* omg : Relaxation factor
* alpha : Upwind-Differencing factor
* dt : Maximum timestep (actual timestep is dynamic)
* tend : End time
* iter : Maximum number of iterations for the solver
* eps : Tolerance for pressure calculation iterations
* tau : "Safety" scaling factor for the timestep

## Testing subsystems
There are tests for the various subsystems of the program. See documentation of the main function for a complete list of them. You can execute the tests by executing the program with one of the test parameters. E.g. ```./numsim TEST_GRID``` performs the tests implemented for the Grid class.

## Disabling live visualisation
Run cmake again with the parameter DEBUG_VISU turned off. E.g. ```cmake -DDEBUG_VISU=OFF CMakeLists.txt```. After that, execute the program like normal.

## Performance analysis
You can generate a performance analysis for the program with gprof, following these steps:

1. ```cmake -DCMAKE_CXX_FLAGS="-pg" CMakeLists.txt```
2. ```make -B```
3. Run the program with the desired parameters
4. ```gprof numsim gmon.out > analysis.txt```

The file analysis.txt now contains a runtime and function call analysis for the run of the program in step 3. Interpreting the results is left as an excercise for the user.
Warning: Any subsequent compilation and run of the program will do a performance analysis, which significantly impacts performance. To remove the injected analysis code, delete all cmake cache files, run cmake without the ```pg``` flags and run ```make -B``` to recompile all files. The cmake cache files are those generated by cmake, that are listed in the file ```.gitignore```.
